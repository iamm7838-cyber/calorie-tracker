<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Calorie Tracker Blueprint</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        /* Custom Scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #d1d5db; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #9ca3af; 
        }
        
        /* Chart Container Utilities */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px; /* Max width for readability */
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
    </style>
    <!-- Chosen Palette: Warm Neutrals & Healthy Earth Tones -->
    <!-- Background: #FDFBF7 (Warm Off-White) -->
    <!-- Primary: #EA580C (Burnt Orange - Energy) -->
    <!-- Secondary: #65A30D (Olive Green - Health/Veg) -->
    <!-- Text: #374151 (Dark Grey - Readability) -->
</head>
<body class="bg-[#FDFBF7] text-gray-700 font-sans min-h-screen flex flex-col">

    <!-- Application Structure Plan:
         1. Header: Title and Intro context.
         2. Main Grid Layout (Responsive):
            - Left Column: Interaction Zone (Add Food Form).
            - Center Column: Data Zone (The Daily Log Table).
            - Right Column: Insight Zone (Live Charts & Totals).
         3. Database Reference Section (Collapsible or Bottom): To view raw data.
         
         Key Interactions: 
         - User selects food -> Populates 'unit' info.
         - User enters quantity -> JS Calculates (simulating the Sheet Formula).
         - User clicks Add -> Updates State (Log Array) -> Triggers Chart Updates.
    -->

    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-stone-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <h1 class="text-3xl font-bold text-stone-800">Calorie Tracker <span class="text-orange-600">Pro</span></h1>
            <p class="mt-2 text-stone-600 max-w-3xl">
                An interactive implementation of the Google Sheet Blueprint. Select foods from the database, apply the 
                quantity multiplier, and watch your daily macros calculate automatically.
            </p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">
        
        <!-- Dashboard Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

            <!-- COLUMN 1: INPUT & CONTROLS (lg:col-span-4) -->
            <div class="lg:col-span-4 flex flex-col gap-6">
                
                <!-- Intro to Input -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100">
                    <h2 class="text-xl font-bold text-stone-800 mb-2">Log Your Meal</h2>
                    <p class="text-sm text-stone-500 mb-4">
                        Simulating the <code class="bg-stone-100 px-1 rounded text-orange-600 font-mono text-xs">VLOOKUP</code> logic. Select an item and a quantity multiplier.
                    </p>

                    <!-- Input Form -->
                    <form id="tracker-form" class="space-y-4">
                        
                        <!-- Meal Selector -->
                        <div>
                            <label class="block text-sm font-medium text-stone-700 mb-1">Meal Type</label>
                            <div class="grid grid-cols-3 gap-2">
                                <button type="button" class="meal-btn active px-4 py-2 text-sm font-medium rounded-lg border border-orange-200 bg-orange-50 text-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500" data-meal="Breakfast">Breakfast</button>
                                <button type="button" class="meal-btn px-4 py-2 text-sm font-medium rounded-lg border border-stone-200 bg-white text-stone-600 hover:bg-stone-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500" data-meal="Lunch">Lunch</button>
                                <button type="button" class="meal-btn px-4 py-2 text-sm font-medium rounded-lg border border-stone-200 bg-white text-stone-600 hover:bg-stone-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500" data-meal="Dinner">Dinner</button>
                            </div>
                        </div>

                        <!-- Food Selector -->
                        <div>
                            <label for="food-select" class="block text-sm font-medium text-stone-700 mb-1">Food Item (from Database)</label>
                            <select id="food-select" class="block w-full rounded-lg border-stone-300 shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm p-2 border bg-stone-50">
                                <option value="" disabled selected>Select a food...</option>
                                <!-- JS will populate this -->
                            </select>
                        </div>

                        <!-- Quantity Input -->
                        <div>
                            <label for="quantity-input" class="block text-sm font-medium text-stone-700 mb-1">
                                Quantity Multiplier 
                                <span class="text-xs text-stone-400 font-normal">(1 = 100g/1 unit)</span>
                            </label>
                            <div class="flex items-center">
                                <input type="number" id="quantity-input" value="1" step="0.1" min="0.1" class="block w-full rounded-l-lg border-stone-300 shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-sm p-2 border border-r-0">
                                <span class="inline-flex items-center px-3 rounded-r-lg border border-l-0 border-stone-300 bg-stone-50 text-gray-500 sm:text-sm h-[38px]">
                                    x Base
                                </span>
                            </div>
                        </div>

                        <!-- Live Preview Card (What formula sees) -->
                        <div id="preview-card" class="hidden bg-stone-50 rounded-lg p-3 border border-stone-200 text-sm">
                            <div class="flex justify-between items-center mb-1">
                                <span class="font-semibold text-stone-700" id="preview-name">Food</span>
                                <span class="text-xs bg-stone-200 px-2 py-0.5 rounded-full text-stone-600" id="preview-type">Type</span>
                            </div>
                            <div class="grid grid-cols-4 gap-2 text-center text-xs text-stone-600">
                                <div>
                                    <span class="block font-bold text-orange-600" id="preview-cals">-</span>
                                    Cals
                                </div>
                                <div>
                                    <span class="block font-bold" id="preview-pro">-</span>
                                    Pro
                                </div>
                                <div>
                                    <span class="block font-bold" id="preview-carb">-</span>
                                    Carb
                                </div>
                                <div>
                                    <span class="block font-bold" id="preview-fat">-</span>
                                    Fat
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition-colors">
                            Add to Daily Log
                        </button>
                    </form>
                </div>

                <!-- Database Reference (Mini) -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100 flex-grow">
                    <h3 class="text-sm font-bold text-stone-800 uppercase tracking-wide mb-3">Database Snapshot</h3>
                    <div class="overflow-y-auto max-h-60 text-xs text-stone-600">
                        <table class="min-w-full divide-y divide-stone-200">
                            <thead class="bg-stone-50">
                                <tr>
                                    <th class="px-2 py-2 text-left">Food</th>
                                    <th class="px-2 py-2 text-right">Cal/Base</th>
                                </tr>
                            </thead>
                            <tbody id="mini-db-body" class="divide-y divide-stone-100">
                                <!-- JS Populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- COLUMN 2: DAILY LOG (lg:col-span-5) -->
            <div class="lg:col-span-5 flex flex-col h-full">
                <div class="bg-white rounded-xl shadow-sm border border-stone-100 flex flex-col h-full overflow-hidden">
                    <div class="p-6 border-b border-stone-100 bg-stone-50 flex justify-between items-center">
                        <div>
                            <h2 class="text-xl font-bold text-stone-800">Daily Log</h2>
                            <p class="text-sm text-stone-500">Today's entries</p>
                        </div>
                        <button id="clear-log" class="text-xs text-red-500 hover:text-red-700 font-medium">Clear Log</button>
                    </div>
                    
                    <div class="flex-grow overflow-auto p-0">
                        <table class="min-w-full divide-y divide-stone-200">
                            <thead class="bg-stone-50 sticky top-0 z-10">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-stone-500 uppercase tracking-wider">Meal/Food</th>
                                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-stone-500 uppercase tracking-wider">Qty</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-stone-500 uppercase tracking-wider">Cals</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-stone-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="log-body" class="bg-white divide-y divide-stone-100">
                                <!-- Empty State -->
                                <tr id="empty-log-state">
                                    <td colspan="4" class="px-6 py-12 text-center text-stone-400 text-sm">
                                        No food logged yet.<br>Select an item on the left to start tracking.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Totals Footer -->
                    <div class="bg-stone-50 p-6 border-t border-stone-200">
                        <div class="flex justify-between items-end mb-2">
                            <span class="text-sm font-medium text-stone-500 uppercase">Total Calories</span>
                            <span class="text-3xl font-bold text-orange-600" id="total-cals-display">0</span>
                        </div>
                        <div class="grid grid-cols-3 gap-4 border-t border-stone-200 pt-4">
                            <div class="text-center">
                                <span class="block text-xs text-stone-500 uppercase">Protein</span>
                                <span class="block text-lg font-bold text-stone-800"><span id="total-pro-display">0</span>g</span>
                            </div>
                            <div class="text-center border-l border-stone-200">
                                <span class="block text-xs text-stone-500 uppercase">Carbs</span>
                                <span class="block text-lg font-bold text-stone-800"><span id="total-carb-display">0</span>g</span>
                            </div>
                            <div class="text-center border-l border-stone-200">
                                <span class="block text-xs text-stone-500 uppercase">Fat</span>
                                <span class="block text-lg font-bold text-stone-800"><span id="total-fat-display">0</span>g</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- COLUMN 3: VISUALIZATION (lg:col-span-3) -->
            <div class="lg:col-span-3 flex flex-col gap-6">
                
                <!-- Chart 1: Macro Breakdown -->
                <div class="bg-white p-4 rounded-xl shadow-sm border border-stone-100">
                    <h3 class="text-sm font-bold text-stone-800 mb-4">Macro Distribution (g)</h3>
                    <!-- Chart Container as required -->
                    <div class="chart-container" style="height: 220px; max-height: 250px;">
                        <canvas id="macroChart"></canvas>
                    </div>
                    <div class="mt-4 flex justify-center space-x-4 text-xs text-stone-600">
                        <div class="flex items-center"><span class="w-2 h-2 rounded-full bg-green-500 mr-1"></span> Carbs</div>
                        <div class="flex items-center"><span class="w-2 h-2 rounded-full bg-orange-500 mr-1"></span> Protein</div>
                        <div class="flex items-center"><span class="w-2 h-2 rounded-full bg-yellow-400 mr-1"></span> Fat</div>
                    </div>
                </div>

                <!-- Chart 2: Calorie Source -->
                <div class="bg-white p-4 rounded-xl shadow-sm border border-stone-100">
                    <h3 class="text-sm font-bold text-stone-800 mb-4">Calories by Meal</h3>
                    <!-- Chart Container as required -->
                    <div class="chart-container" style="height: 200px; max-height: 250px;">
                        <canvas id="mealChart"></canvas>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-stone-50 border-t border-stone-200 mt-auto">
        <div class="max-w-7xl mx-auto px-4 py-6 text-center text-xs text-stone-400">
            Interactive Blueprint based on "Calorie Tracker Setup" &bull; Uses Chart.js & Tailwind CSS
        </div>
    </footer>

    <!-- Visualization & Content Choices:
         1. Food Database (JS Object): Mirrors the 'Database' tab in the sheet.
         2. Dynamic Table: Mirrors the 'Daily Log' tab.
         3. Charts: Chosen to visualize the 'Totals' section which is hard to read as just numbers.
            - Doughnut Chart: Perfect for seeing the balance of Macros (Part to Whole).
            - Bar Chart: Good for comparing intake across Breakfast/Lunch/Dinner.
         4. Interaction: Simplified 'VLOOKUP' logic into a direct object lookup.
    -->

    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <script>
        // --- 1. DATA STORAGE (The "Database" Tab) ---
        // Mirroring the Bulk Starter Data from the Blueprint
        const foodDatabase = [
            { type: "CARBS", name: "Carb - Rice (White, Cooked, 100g)", cal: 130, pro: 2.7, carb: 28, fat: 0.3 },
            { type: "CARBS", name: "Carb - Rice (Brown, Cooked, 100g)", cal: 111, pro: 2.6, carb: 23, fat: 0.9 },
            { type: "CARBS", name: "Carb - Oats (Dry, 100g)", cal: 389, pro: 16.9, carb: 66, fat: 6.9 },
            { type: "CARBS", name: "Carb - Potato (Boiled, 100g)", cal: 87, pro: 1.9, carb: 20, fat: 0.1 },
            { type: "CARBS", name: "Carb - Bread (Whole Wheat, 1 slice)", cal: 80, pro: 4, carb: 13, fat: 1 },
            { type: "PROTEIN", name: "Protein - Chicken Breast (Raw, 100g)", cal: 165, pro: 31, carb: 0, fat: 3.6 },
            { type: "PROTEIN", name: "Protein - Ground Beef (90% Lean, 100g)", cal: 176, pro: 20, carb: 0, fat: 10 },
            { type: "PROTEIN", name: "Protein - Salmon (Raw, 100g)", cal: 208, pro: 20, carb: 0, fat: 13 },
            { type: "PROTEIN", name: "Protein - Egg (Large, 1 unit)", cal: 78, pro: 6, carb: 0.6, fat: 5 },
            { type: "PROTEIN", name: "Protein - Tofu (Firm, 100g)", cal: 144, pro: 17, carb: 3, fat: 9 },
            { type: "FRUIT/VEG", name: "Fruit - Banana (Medium)", cal: 105, pro: 1.3, carb: 27, fat: 0.4 },
            { type: "FRUIT/VEG", name: "Fruit - Apple (Medium)", cal: 95, pro: 0.5, carb: 25, fat: 0.3 },
            { type: "FRUIT/VEG", name: "Veg - Broccoli (Steamed, 100g)", cal: 35, pro: 2.4, carb: 7, fat: 0.4 },
            { type: "FRUIT/VEG", name: "Veg - Spinach (Raw, 100g)", cal: 23, pro: 2.9, carb: 3.6, fat: 0.4 },
            { type: "DAIRY/FATS", name: "Dairy - Greek Yogurt (Plain, 100g)", cal: 59, pro: 10, carb: 3.6, fat: 0.4 },
            { type: "DAIRY/FATS", name: "Fat - Peanut Butter (1 tbsp)", cal: 94, pro: 4, carb: 3, fat: 8 },
            { type: "DAIRY/FATS", name: "Fat - Olive Oil (1 tbsp)", cal: 119, pro: 0, carb: 0, fat: 14 }
        ];

        // State for Daily Log
        let dailyLog = [];
        let currentMeal = "Breakfast";

        // --- 2. INITIALIZATION & DOM ELEMENTS ---
        const foodSelect = document.getElementById('food-select');
        const quantityInput = document.getElementById('quantity-input');
        const previewCard = document.getElementById('preview-card');
        const trackerForm = document.getElementById('tracker-form');
        const logBody = document.getElementById('log-body');
        const emptyState = document.getElementById('empty-log-state');
        const miniDbBody = document.getElementById('mini-db-body');
        const mealBtns = document.querySelectorAll('.meal-btn');
        const clearLogBtn = document.getElementById('clear-log');

        // Chart Instances
        let macroChart = null;
        let mealChart = null;

        // Populate Dropdown & Mini DB
        function initApp() {
            foodDatabase.forEach((food, index) => {
                // Dropdown Option
                const option = document.createElement('option');
                option.value = index;
                option.textContent = food.name;
                foodSelect.appendChild(option);

                // Mini DB Row
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-2 py-1 truncate">${food.name.split(' - ')[1] || food.name}</td>
                    <td class="px-2 py-1 text-right font-mono text-orange-600">${food.cal}</td>
                `;
                miniDbBody.appendChild(row);
            });
            
            initCharts();
        }

        // --- 3. EVENT LISTENERS ---

        // Meal Selection
        mealBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                mealBtns.forEach(b => {
                    b.classList.remove('bg-orange-50', 'border-orange-200', 'text-orange-700', 'active');
                    b.classList.add('bg-white', 'border-stone-200', 'text-stone-600');
                });
                btn.classList.remove('bg-white', 'border-stone-200', 'text-stone-600');
                btn.classList.add('bg-orange-50', 'border-orange-200', 'text-orange-700', 'active');
                currentMeal = btn.dataset.meal;
            });
        });

        // Food Selection (Preview Update)
        foodSelect.addEventListener('change', updatePreview);
        quantityInput.addEventListener('input', updatePreview);

        function updatePreview() {
            const index = foodSelect.value;
            if (index === "") {
                previewCard.classList.add('hidden');
                return;
            }
            
            previewCard.classList.remove('hidden');
            const food = foodDatabase[index];
            const qty = parseFloat(quantityInput.value) || 0;

            document.getElementById('preview-name').textContent = food.name.split(' - ')[1] || food.name;
            document.getElementById('preview-type').textContent = food.type;
            
            // Calculate Previews (The VLOOKUP math)
            document.getElementById('preview-cals').textContent = Math.round(food.cal * qty);
            document.getElementById('preview-pro').textContent = (food.pro * qty).toFixed(1);
            document.getElementById('preview-carb').textContent = (food.carb * qty).toFixed(1);
            document.getElementById('preview-fat').textContent = (food.fat * qty).toFixed(1);
        }

        // Add to Log
        trackerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const index = foodSelect.value;
            if (index === "") return;

            const food = foodDatabase[index];
            const qty = parseFloat(quantityInput.value) || 0;

            const entry = {
                id: Date.now(),
                meal: currentMeal,
                foodName: food.name,
                qty: qty,
                cals: Math.round(food.cal * qty),
                pro: parseFloat((food.pro * qty).toFixed(1)),
                carb: parseFloat((food.carb * qty).toFixed(1)),
                fat: parseFloat((food.fat * qty).toFixed(1))
            };

            dailyLog.push(entry);
            renderLog();
            updateTotals();
            updateCharts();
            
            // Reset input slightly, keep meal same
            quantityInput.value = 1;
            updatePreview();
        });

        // Clear Log
        clearLogBtn.addEventListener('click', () => {
            if(confirm("Clear all entries for today?")) {
                dailyLog = [];
                renderLog();
                updateTotals();
                updateCharts();
            }
        });

        // --- 4. RENDERING & LOGIC ---

        function renderLog() {
            logBody.innerHTML = '';
            
            if (dailyLog.length === 0) {
                logBody.appendChild(emptyState);
                return;
            }

            // Sort by Meal Order (Breakfast > Lunch > Dinner)
            const mealOrder = { "Breakfast": 1, "Lunch": 2, "Dinner": 3 };
            dailyLog.sort((a, b) => mealOrder[a.meal] - mealOrder[b.meal]);

            dailyLog.forEach(entry => {
                const tr = document.createElement('tr');
                const cleanName = entry.foodName.includes('-') ? entry.foodName.split(' - ')[1] : entry.foodName;
                
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div>
                                <div class="text-sm font-medium text-stone-900">${cleanName}</div>
                                <div class="text-xs text-stone-500">${entry.meal}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-stone-100 text-stone-800">
                            x${entry.qty}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm text-stone-500 font-mono">
                        ${entry.cals}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button class="text-red-400 hover:text-red-600" onclick="deleteEntry(${entry.id})">
                            &times;
                        </button>
                    </td>
                `;
                logBody.appendChild(tr);
            });
        }

        window.deleteEntry = function(id) {
            dailyLog = dailyLog.filter(e => e.id !== id);
            renderLog();
            updateTotals();
            updateCharts();
        }

        function updateTotals() {
            const totals = dailyLog.reduce((acc, curr) => {
                acc.cals += curr.cals;
                acc.pro += curr.pro;
                acc.carb += curr.carb;
                acc.fat += curr.fat;
                return acc;
            }, { cals: 0, pro: 0, carb: 0, fat: 0 });

            document.getElementById('total-cals-display').textContent = totals.cals;
            document.getElementById('total-pro-display').textContent = totals.pro.toFixed(1);
            document.getElementById('total-carb-display').textContent = totals.carb.toFixed(1);
            document.getElementById('total-fat-display').textContent = totals.fat.toFixed(1);
        }

        // --- 5. CHARTS (Chart.js) ---

        function initCharts() {
            const commonOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false // Custom legends usually look better or implied
                    }
                }
            };

            // Macro Chart (Doughnut)
            const ctxMacro = document.getElementById('macroChart').getContext('2d');
            macroChart = new Chart(ctxMacro, {
                type: 'doughnut',
                data: {
                    labels: ['Carbs', 'Protein', 'Fat'],
                    datasets: [{
                        data: [0, 0, 0], // Init empty
                        backgroundColor: ['#22c55e', '#f97316', '#facc15'], // Green, Orange, Yellow
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    ...commonOptions,
                    cutout: '70%',
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return ` ${context.label}: ${context.raw}g`;
                                }
                            }
                        }
                    }
                }
            });

            // Meal Chart (Bar)
            const ctxMeal = document.getElementById('mealChart').getContext('2d');
            mealChart = new Chart(ctxMeal, {
                type: 'bar',
                data: {
                    labels: ['Bfast', 'Lunch', 'Dinner'],
                    datasets: [{
                        label: 'Calories',
                        data: [0, 0, 0],
                        backgroundColor: '#ea580c',
                        borderRadius: 4
                    }]
                },
                options: {
                    ...commonOptions,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                display: false
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        function updateCharts() {
            // Update Macro Chart Data
            const totalCarb = dailyLog.reduce((sum, item) => sum + item.carb, 0);
            const totalPro = dailyLog.reduce((sum, item) => sum + item.pro, 0);
            const totalFat = dailyLog.reduce((sum, item) => sum + item.fat, 0);

            // Prevent empty chart ugly render
            if (totalCarb + totalPro + totalFat === 0) {
                 macroChart.data.datasets[0].data = [0.1, 0.1, 0.1]; // Dummy equal
                 macroChart.data.datasets[0].backgroundColor = ['#e5e7eb', '#e5e7eb', '#e5e7eb']; // Grey
            } else {
                 macroChart.data.datasets[0].data = [totalCarb, totalPro, totalFat];
                 macroChart.data.datasets[0].backgroundColor = ['#22c55e', '#f97316', '#facc15'];
            }
            macroChart.update();

            // Update Meal Chart Data
            const bfastCals = dailyLog.filter(i => i.meal === 'Breakfast').reduce((s, i) => s + i.cals, 0);
            const lunchCals = dailyLog.filter(i => i.meal === 'Lunch').reduce((s, i) => s + i.cals, 0);
            const dinnerCals = dailyLog.filter(i => i.meal === 'Dinner').reduce((s, i) => s + i.cals, 0);

            mealChart.data.datasets[0].data = [bfastCals, lunchCals, dinnerCals];
            mealChart.update();
        }

        // Run
        initApp();

    </script>
</body>
</html>
